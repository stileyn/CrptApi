# Основные компоненты:
## CrptApi class:

- OkHttpClient используется для выполнения HTTP-запросов.
- ObjectMapper из библиотеки Jackson преобразует объекты Java в JSON и наоборот.
- ScheduledExecutorService используется для периодического обновления времени последнего запроса.
- ReentrantLock используется для синхронизации доступа к общим ресурсам.
## createDocument method:

- Метод для создания документа во внешней системе.
- Принимает объект Document и подпись (signature) в качестве параметров.
- Сначала проверяет лимит запросов с использованием checkRequestLimit.
- Затем создает JSON-объект с данными из Document и отправляет его во внешнюю систему через HTTP POST-запрос.
- Обрабатывает ответ с использованием handleResponse.
## checkRequestLimit method:

- Проверяет, прошло ли достаточное время с момента последнего запроса, чтобы удовлетворить установленный лимит запросов в секунду.
- Если лимит превышен, блокирует выполнение до тех пор, пока не пройдет достаточное время.
## handleResponse method:

- Обрабатывает ответ от сервера после выполнения HTTP-запроса.
- Логгирует успешные и неуспешные ответы.
## Document and Product classes:

- Классы для представления данных документа и продукта, которые будут отправлены во внешнюю систему.
## Принцип работы:
1. Инициализация:

- При создании экземпляра CrptApi инициализируются необходимые компоненты, такие как OkHttpClient, ObjectMapper, ScheduledExecutorService, и другие.
2. Создание документа:

- В методе createDocument создается JSON-объект из данных Document.
- Выполняется HTTP POST-запрос с использованием OkHttpClient по указанному URL.
- Обработка ответа происходит в методе handleResponse.
3. Проверка лимита запросов:

- В методе checkRequestLimit проверяется, прошло ли достаточное время с момента последнего запроса.
- Если лимит запросов в секунду превышен, метод блокирует выполнение до тех пор, пока не наступит новый временной интервал.
4. Логирование:

- Весь код обильно использует логгирование с использованием SLF4J и Logback. Логи позволяют отслеживать действия программы, и в данном случае, успешность или неудачу HTTP-запросов.
5. Запуск:

- В методе main создается экземпляр CrptApi, формируется пустой объект Document, и вызывается метод createDocument для отправки запроса.

# CrptApiTest - Тесты для класса CrptApi
## Метод: createDocument_SuccessfulRequest()
### Цель теста:
- Проверка корректной обработки успешного HTTP-запроса при использовании реального OkHttpClient и эмуляции HTTP-сервера с использованием MockWebServer.

### Шаги:
1. Создание экземпляра класса CrptApi.
2. Создание объекта CrptApi.Document и установка подписи (signature).
3. Создание реального экземпляра OkHttpClient.
4. Запуск MockWebServer для эмуляции HTTP-сервера.
5. Настройка MockWebServer для установки базового URL и обработки запросов.
6. Установка реального OkHttpClient в CrptApi.
7. Вызов метода createDocument.
8. Проверка, что запрос был отправлен на MockWebServer.
9. Остановка MockWebServer.
### Ожидаемые результаты:
- Метод createDocument успешно отправляет запрос.
- Запрос был отправлен на URL, соответствующий базовому URL MockWebServer.
### Сценарий ошибки:
- Запрос не был отправлен на MockWebServer.
- Тест завершился ошибкой или исключением.
## Метод: createDocument_FailedRequest()
### Цель теста:
- Проверка корректной обработки неудачного HTTP-запроса при использовании мокированного OkHttpClient и эмуляции ошибочного ответа.

### Шаги:
1. Создание экземпляра класса CrptApi.
2. Создание объекта CrptApi.Document и установка подписи (signature).
3. Мокирование OkHttpClient и создание моков для Response и Call.
4. Настройка поведения моков для эмуляции ошибочного HTTP-ответа.
5. Установка мокированного OkHttpClient в CrptApi.
6. Вызов метода createDocument.
### Ожидаемые результаты:
- Метод createDocument успешно обрабатывает ошибочный HTTP-ответ.
### Сценарий ошибки:
- Тест завершился ошибкой или исключением.
## Метод: checkRequestLimit_WaitForInterval()
### Цель теста:
- Проверка корректного сброса лимита запросов после ожидания заданного интервала времени в методе checkRequestLimit.

### Шаги:
1. Создание экземпляра класса CrptApi.
2. Установка прошедшего времени, чтобы сработало условие ожидания.
3. Установка лимита запросов равным 1, чтобы метод заснул.
4. Вызов метода checkRequestLimit.
5. Проверка, что прошло достаточное время и лимит сброшен.
### Ожидаемые результаты:
- Метод checkRequestLimit успешно ожидает заданный интервал времени и сбрасывает лимит запросов.
### Сценарий ошибки:
- Тест завершился ошибкой или исключением.